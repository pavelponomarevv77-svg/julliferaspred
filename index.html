<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор клинингового персонала и химчистки Jullife</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path fill="rgba(255,255,255,0.05)" d="M0,0 L100,0 L100,100 Z"/></svg>');
            background-size: cover;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            position: relative;
            text-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
        }
        
        .logo-icon {
            background: white;
            color: #4b6cb7;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            font-weight: 300;
        }
        
        .calculator {
            display: flex;
            flex-wrap: wrap;
            padding: 30px;
        }
        
        .input-section {
            flex: 1;
            min-width: 350px;
            padding-right: 30px;
            border-right: 1px solid #eee;
        }
        
        .additional-services {
            flex: 1;
            min-width: 350px;
            padding: 0 30px;
            border-right: 1px solid #eee;
        }
        
        .dry-cleaning-section {
            flex: 1;
            min-width: 350px;
            padding-left: 30px;
        }
        
        .results-section {
            width: 100%;
            padding: 30px;
            margin-top: 20px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 1200px) {
            .input-section, .additional-services, .dry-cleaning-section {
                padding: 20px 0;
                border: none;
                min-width: 100%;
            }
            
            .calculator {
                flex-direction: column;
            }
            
            .results-section {
                padding: 20px 0;
            }
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #182848;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4b6cb7;
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: #4b6cb7;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #182848;
            font-size: 1rem;
        }
        
        .input-with-unit {
            display: flex;
            align-items: center;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #e0e6ff;
            transition: all 0.3s;
        }
        
        .input-with-unit:focus-within {
            border-color: #4b6cb7;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.1);
        }
        
        .input-with-unit input {
            flex: 1;
            margin-right: 0;
            border: none;
            border-radius: 0;
        }
        
        .unit {
            font-weight: 600;
            color: white;
            min-width: 70px;
            background: #4b6cb7;
            padding: 12px 15px;
            text-align: center;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e6ff;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s, box-shadow 0.3s;
            background-color: #f8faff;
        }
        
        input:focus, select:focus {
            border-color: #4b6cb7;
            outline: none;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.1);
        }
        
        .slider-container {
            margin-top: 15px;
            padding: 0 10px;
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 8px;
        }
        
        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            background: #f8faff;
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #e0e6ff;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }
        
        .radio-option:hover, .checkbox-option:hover {
            border-color: #4b6cb7;
            background-color: #eef2ff;
        }
        
        .radio-option input, .checkbox-option input {
            width: auto;
            margin-right: 10px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(75, 108, 183, 0.3);
        }
        
        .btn i {
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(75, 108, 183, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-reset:hover {
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.4);
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .results-card {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 6px solid #4b6cb7;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }
        
        .results-card:hover {
            transform: translateY(-5px);
        }
        
        .results-title {
            font-size: 1.4rem;
            color: #182848;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            display: flex;
            align-items: center;
        }
        
        .results-title i {
            margin-right: 10px;
            color: #4b6cb7;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .result-label {
            font-weight: 500;
            color: #555;
            display: flex;
            align-items: center;
        }
        
        .result-label i {
            margin-right: 8px;
            color: #4b6cb7;
            font-size: 0.9rem;
        }
        
        .result-value {
            font-weight: 700;
            color: #182848;
            text-align: right;
            font-size: 1.1rem;
        }
        
        .highlight {
            background: linear-gradient(135deg, #eef2ff 0%, #e0e6ff 100%);
            padding: 15px;
            border-radius: 12px;
            font-weight: 700;
            color: #182848;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            border: 2px solid #c5d1ff;
        }
        
        .recommendation {
            background-color: #fff9e6;
            border-left-color: #ffc107;
        }
        
        .recommendation-title {
            color: #856404;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .recommendation-title i {
            margin-right: 10px;
            color: #ffc107;
        }
        
        .work-plan {
            margin-top: 15px;
        }
        
        .work-plan-item {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
        }
        
        .work-plan-badge {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: 600;
            flex-shrink: 0;
            box-shadow: 0 3px 8px rgba(75, 108, 183, 0.3);
        }
        
        .info-text {
            font-size: 0.9rem;
            color: #666;
            margin-top: 8px;
            font-style: italic;
            padding-left: 5px;
        }
        
        .footer {
            text-align: center;
            padding: 25px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 20px;
            background-color: #f8faff;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 10px;
            background: #dde1e9;
            outline: none;
            transition: background 0.3s;
        }
        
        .slider:hover {
            background: #c5cbd9;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4b6cb7;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(75, 108, 183, 0.4);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #4b6cb7;
            cursor: pointer;
            border: 4px solid white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.85rem;
            color: #777;
        }
        
        .complexity-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .low-complexity {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }
        
        .medium-complexity {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
        }
        
        .high-complexity {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #4b6cb7;
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f8faff;
            border-radius: 12px;
            border-left: 5px solid #4b6cb7;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .service-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .service-info {
            flex: 1;
            padding-right: 15px;
        }
        
        .service-name {
            font-weight: 600;
            color: #182848;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .service-details {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
        
        .service-price {
            color: #28a745;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .service-time {
            color: #6c757d;
            font-size: 0.8rem;
        }
        
        .service-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .service-quantity {
            width: 80px;
            padding: 10px;
            text-align: center;
            border: 2px solid #e0e6ff;
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
        }
        
        .service-quantity:focus {
            border-color: #4b6cb7;
            outline: none;
        }
        
        .service-total {
            min-width: 80px;
            text-align: right;
            font-weight: 600;
            color: #182848;
            font-size: 1rem;
        }
        
        .additional-total {
            background: linear-gradient(135deg, #eef2ff 0%, #e0e6ff 100%);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            font-weight: 600;
            text-align: center;
            border: 2px solid #c5dcff;
        }
        
        .time-breakdown {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 12px;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dotted #dee2e6;
        }
        
        .breakdown-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .breakdown-label {
            color: #555;
            font-weight: 500;
        }
        
        .breakdown-value {
            font-weight: 700;
            color: #182848;
        }
        
        .maintenance-note {
            color: #4b6cb7;
            font-weight: 600;
            margin-bottom: 10px;
            padding: 10px 15px;
            background-color: #eef2ff;
            border-radius: 8px;
            border-left: 5px solid #4b6cb7;
        }
        
        .table-based-info {
            background: linear-gradient(135deg, #f0f7ff 0%, #e6f0ff 100%);
            padding: 15px;
            border-radius: 12px;
            margin-top: 10px;
            font-size: 0.95rem;
            border-left: 5px solid #4b6cb7;
        }
        
        .efficiency-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
            border-left: 5px solid #ffc107;
        }
        
        .economy-warning {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
            border-left: 5px solid #dc3545;
        }
        
        .economy-ok {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
            border-left: 5px solid #28a745;
        }
        
        .cost-section {
            background: linear-gradient(135deg, #f0f7ff 0%, #e6f0ff 100%);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border-left: 6px solid #28a745;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .cost-title {
            font-size: 1.3rem;
            color: #182848;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #c5dcff;
            display: flex;
            align-items: center;
        }
        
        .cost-title i {
            margin-right: 10px;
            color: #28a745;
        }
        
        .cost-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dashed #c5dcff;
        }
        
        .cost-item:last-child {
            border-bottom: none;
        }
        
        .cost-label {
            font-weight: 500;
            color: #555;
        }
        
        .cost-value {
            font-weight: 700;
            color: #182848;
        }
        
        .cost-total {
            font-size: 1.4rem;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 3px solid #c5dcff;
        }
        
        .economy-option {
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            border: 2px dashed #ffc107;
        }
        
        .staff-toggle {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e0e6ff;
        }
        
        .staff-toggle label {
            margin-bottom: 0;
            margin-right: 10px;
            font-weight: 600;
        }
        
        .staff-toggle input {
            width: auto;
            margin-right: 5px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin: 0 15px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        input:checked + .toggle-slider {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .pollution-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 5px;
        }
        
        .pollution-low { background-color: #28a745; }
        .pollution-medium { background-color: #ffc107; }
        .pollution-high { background-color: #fd7e14; }
        .pollution-very-high { background-color: #dc3545; }
        .pollution-extreme { background-color: #721c24; }
        
        .feature-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 15px;
            font-size: 18px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8faff;
            border-radius: 10px;
            border: 2px solid #e0e6ff;
        }
        
        .feature-text {
            font-weight: 500;
            color: #182848;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #182848;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #182848 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .discount-section {
            background: linear-gradient(135deg, #e6f7ff 0%, #d1f0ff 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 5px solid #17a2b8;
        }
        
        .discount-badge {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .logistic-services {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 5px solid #ffc107;
        }
        
        .final-price {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 5px solid #28a745;
            font-weight: 700;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .staff-selection-section {
            background: linear-gradient(135deg, #eef2ff 0%, #e0e6ff 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 5px solid #4b6cb7;
        }
        
        .staff-selection-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        
        .staff-selection-btn {
            background: white;
            border: 2px solid #4b6cb7;
            color: #4b6cb7;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .staff-selection-btn:hover {
            background: #4b6cb7;
            color: white;
            transform: scale(1.1);
        }
        
        .staff-count-display {
            font-size: 1.5rem;
            font-weight: 700;
            color: #182848;
            min-width: 40px;
            text-align: center;
        }
        
        .staff-recommendation {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .staff-warning {
            color: #dc3545;
            font-weight: 600;
        }
        
        .staff-ok {
            color: #28a745;
            font-weight: 600;
        }
        
        /* Новые стили для блока химчистки */
        .dry-cleaning-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f8faff;
            border-radius: 12px;
            border-left: 5px solid #9c27b0;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .dry-cleaning-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .dry-cleaning-info {
            flex: 1;
            padding-right: 15px;
        }
        
        .dry-cleaning-name {
            font-weight: 600;
            color: #182848;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .dry-cleaning-details {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
        
        .dry-cleaning-price {
            color: #9c27b0;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .dry-cleaning-category {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid #7b1fa2;
        }
        
        .dry-cleaning-category-title {
            font-size: 1.2rem;
            color: #4a148c;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e1bee7;
            display: flex;
            align-items: center;
        }
        
        .dry-cleaning-category-title i {
            margin-right: 10px;
            color: #7b1fa2;
        }
        
        .dry-cleaning-total {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            font-weight: 600;
            text-align: center;
            border: 2px solid #ba68c8;
        }
        
        .dry-cleaning-icon {
            color: #9c27b0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-broom"></i>
                </div>
                <h1>Калькулятор клинингового персонала и химчистки Jullife</h1>
            </div>
            <p class="subtitle">Профессиональный расчет времени, персонала и стоимости уборки и химчистки для объектов от 0 до 1500 м².</p>
        </header>
        
        <div class="calculator">
            <div class="input-section">
                <h2 class="section-title"><i class="fas fa-sliders-h"></i> Основные параметры</h2>
                
                <div class="feature-item">
                    <div class="feature-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="feature-text">Подбор персонала по типу объекта и загрязнению</div>
                </div>
                
                <div class="form-group">
                    <label for="objectType"><i class="fas fa-building"></i> Тип объекта:</label>
                    <select id="objectType">
                        <option value="apartment" selected>Квартира (коэфф. 1.0)</option>
                        <option value="house">Частный дом / Коттедж (коэфф. 1.2)</option>
                        <option value="office">Офис open-space (коэфф. 0.7)</option>
                        <option value="commercial">Коммерческое помещение (коэфф. 1.1)</option>
                        <option value="restaurant">Ресторан / Кафе (коэфф. 1.3)</option>
                    </select>
                    <div class="info-text">Коэффициенты учитывают сложность уборки для разных типов объектов</div>
                </div>
                
                <div class="form-group">
                    <label for="area"><i class="fas fa-vector-square"></i> Площадь помещения:</label>
                    <div class="input-with-unit">
                        <input type="number" id="area" min="0" max="5000" value="100">
                        <div class="unit">м²</div>
                    </div>
                    <div class="slider-container">
                        <input type="range" min="0" max="1500" value="100" class="slider" id="areaSlider">
                        <div class="slider-labels">
                            <span>0 м²</span>
                            <span>500 м²</span>
                            <span>1500 м²</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-broom"></i> Тип уборки:</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="cleaningType" value="maintenance" checked>
                            <i class="fas fa-sparkles"></i> Поддерживающая
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="cleaningType" value="general_light">
                            <i class="fas fa-broom"></i> Генеральная лайт
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="cleaningType" value="general_full">
                            <i class="fas fa-pump-soap"></i> Генеральная полная
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="cleaningType" value="post_construction">
                            <i class="fas fa-hard-hat"></i> После ремонта
                        </label>
                    </div>
                    <div class="info-text">Основано на отраслевых нормативах времени уборки</div>
                </div>
                
                <div class="form-group">
                    <label for="pollutionLevel"><i class="fas fa-tint"></i> Степень загрязнения:</label>
                    <select id="pollutionLevel">
                        <option value="0.8">Легкая (регулярная уборка) <span class="pollution-indicator pollution-low"></span> ×0.8</option>
                        <option value="1.0" selected>Средняя (нормальная) <span class="pollution-indicator pollution-medium"></span> ×1.0</option>
                        <option value="1.3">Сильная (долго не убиралось) <span class="pollution-indicator pollution-high"></span> ×1.3</option>
                        <option value="2.2">Очень сильная (экстремальная) <span class="pollution-indicator pollution-very-high"></span> ×2.2</option>
                        <option value="2.6">После стройки/ремонта <span class="pollution-indicator pollution-extreme"></span> ×2.6</option>
                    </select>
                    <div class="info-text">Коэффициенты умножаются на время уборки и влияют на стоимость</div>
                </div>
                
                <div class="staff-selection-section">
                    <h3 class="section-title" style="font-size: 1.2rem; border-bottom: 2px solid #4b6cb7;">
                        <i class="fas fa-user-friends"></i> Выбор количества сотрудников
                    </h3>
                    
                    <div class="form-group">
                        <label><i class="fas fa-users"></i> Режим подбора персонала:</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="staffMode" value="auto" id="staffModeAuto" checked>
                                <i class="fas fa-robot"></i> Автоматический подбор
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="staffMode" value="manual" id="staffModeManual">
                                <i class="fas fa-user-edit"></i> Ручной выбор
                            </label>
                        </div>
                    </div>
                    
                    <div id="manualStaffSelection" style="display: none;">
                        <div class="staff-selection-controls">
                            <button class="staff-selection-btn" id="decreaseStaff">
                                <i class="fas fa-minus"></i>
                            </button>
                            
                            <div class="staff-count-display" id="staffCount">2</div>
                            
                            <button class="staff-selection-btn" id="increaseStaff">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="staff-recommendation" id="staffRecommendation">
                            Рекомендуется: <span id="recommendedStaffCount">2</span> сотрудника
                        </div>
                    </div>
                    
                    <div id="autoStaffInfo">
                        <div class="info-text" style="margin-top: 10px;">
                            <i class="fas fa-robot"></i> Калькулятор автоматически подберет оптимальное количество сотрудников 
                            на основе площади, типа уборки и экономических показателей.
                        </div>
                    </div>
                </div>
                
                <div class="form-group staff-toggle">
                    <label for="economyMode"><i class="fas fa-chart-line"></i> Экономический режим:</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="economyMode" checked>
                        <span class="toggle-slider"></span>
                    </div>
                    <span id="economyStatus">ВКЛ</span>
                    <div class="info-text" style="margin-left: 10px;">Учитывает стоимость выхода сотрудника и маржинальность</div>
                </div>
                
                <div class="discount-section">
                    <h3 class="section-title" style="font-size: 1.2rem; border-bottom: 2px solid #17a2b8;"><i class="fas fa-percentage"></i> Скидка</h3>
                    <div class="form-group">
                        <label for="discount"><i class="fas fa-tag"></i> Скидка (%):</label>
                        <div class="input-with-unit">
                            <input type="number" id="discount" min="0" max="100" value="0" step="1">
                            <div class="unit">%</div>
                        </div>
                        <div class="slider-container">
                            <input type="range" min="0" max="100" value="0" class="slider" id="discountSlider">
                            <div class="slider-labels">
                                <span>0%</span>
                                <span>50%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        <div class="info-text">Укажите размер скидки в процентах. Скидка применяется к итоговой стоимости.</div>
                    </div>
                </div>
                
                <div class="logistic-services">
                    <h3 class="section-title" style="font-size: 1.2rem; border-bottom: 2px solid #ffc107;"><i class="fas fa-truck"></i> Логистические услуги</h3>
                    <div class="form-group">
                        <label><i class="fas fa-car"></i> Выезд автомобиля:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-option">
                                <input type="checkbox" id="carService" data-price="4500">
                                <i class="fas fa-car"></i> Выезд автомобиля (4 500 руб.)
                            </label>
                        </div>
                        <div class="info-text">Включает доставку сотрудников и базового оборудования</div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-tools"></i> Доставка оборудования:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-option">
                                <input type="checkbox" id="equipmentDelivery" data-price="1500">
                                <i class="fas fa-truck-loading"></i> Доставка оборудования (1 500 руб.)
                            </label>
                        </div>
                        <div class="info-text">Пылесос, парогенератор, стремянка и другое спецоборудование</div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Рассчитать полную стоимость
                    </button>
                    <button class="btn btn-reset" id="resetBtn">
                        <i class="fas fa-redo"></i> Сбросить все параметры
                    </button>
                </div>
                
                <div class="loading" id="loadingIndicator">
                    <i class="fas fa-spinner fa-spin"></i> Расчёт...
                </div>
            </div>
            
            <div class="additional-services">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Дополнительные услуги клининга</h2>
                
                <div class="feature-item">
                    <div class="feature-icon">
                        <i class="fas fa-concierge-bell"></i>
                    </div>
                    <div class="feature-text">Добавьте дополнительные услуги к основной уборке</div>
                </div>
                
                <div class="info-text">Укажите количество нужных услуг (время добавится к основному)</div>
                
                <div id="servicesContainer">
                    <!-- Список дополнительных услуг будет сгенерирован JavaScript -->
                </div>
                
                <div class="additional-total" id="additionalServicesTotal">
                    <i class="fas fa-receipt"></i> Дополнительные услуги: 0 часов, 0 руб.
                </div>
            </div>
            
            <div class="dry-cleaning-section">
                <h2 class="section-title"><i class="fas fa-tshirt"></i> Услуги химчистки</h2>
                
                <!-- ДОБАВЛЕНА ПОМЕТКА О МИНИМАЛЬНОМ ЗАКАЗЕ -->
                <div class="info-text" style="margin-bottom: 15px; padding: 10px; background-color: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <i class="fas fa-exclamation-circle"></i> <strong>Минимальный заказ:</strong> Стоимость заказа только химчистки (без клининга) должна быть не менее 5 000 руб.
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon" style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);">
                        <i class="fas fa-tshirt"></i>
                    </div>
                    <div class="feature-text">Услуги химчистки</div>
                </div>
                
                <div id="dryCleaningContainer">
                    <!-- Список услуг химчистки будет сгенерирован JavaScript -->
                </div>
                
                <div class="dry-cleaning-total" id="dryCleaningTotal">
                    <i class="fas fa-receipt"></i> Услуги химчистки: 0 руб.
                </div>
            </div>
        </div>
        
        <div class="results-section">
            <div class="results-card">
                <h2 class="results-title"><i class="fas fa-chart-bar"></i> Результаты расчета</h2>
                
                <div class="result-item">
                    <div class="result-label"><i class="far fa-clock"></i> Основная уборка:</div>
                    <div class="result-value" id="baseTime">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label"><i class="fas fa-plus-circle"></i> Дополнительные услуги клининга:</div>
                    <div class="result-value" id="additionalTime">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label"><i class="fas fa-tshirt"></i> Услуги химчистки:</div>
                    <div class="result-value" id="dryCleaningCostResult">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label"><i class="fas fa-clock"></i> Общее время уборки:</div>
                    <div class="result-value" id="totalTime">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label"><i class="fas fa-users"></i> Количество сотрудников:</div>
                    <div class="result-value" id="staffRequired">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label"><i class="fas fa-tachometer-alt"></i> Сложность задачи:</div>
                    <div class="result-value">
                        <span id="complexityLevel">-</span>
                        <span id="complexityBadge" class="complexity-badge"></span>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="result-label"><i class="fas fa-user-clock"></i> Затраты времени на 1 сотрудника:</div>
                    <div class="result-value" id="timePerWorker">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label"><i class="fas fa-money-bill-wave"></i> Стоимость основной уборки:</div>
                    <div class="result-value" id="mainCleaningCostResult">-</div>
                </div>
                
                <div class="highlight" id="recommendationMain">
                    <i class="fas fa-magic"></i> Заполните параметры и нажмите "Рассчитать"
                </div>
            </div>
            
            <div class="cost-section" id="costSection" style="display: none;">
                <h2 class="cost-title"><i class="fas fa-money-bill-wave"></i> Экономический расчет и маржинальность</h2>
                
                <div class="cost-item">
                    <div class="cost-label">Количество сотрудников:</div>
                    <div class="cost-value" id="costStaff">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Стоимость выхода 1 сотрудника:</div>
                    <div class="cost-value">4 500 руб.</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Стоимость основной уборки (из прайса):</div>
                    <div class="cost-value" id="mainCleaningCost">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Стоимость дополнительных услуг клининга:</div>
                    <div class="cost-value" id="additionalCost">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Стоимость услуг химчистки:</div>
                    <div class="cost-value" id="dryCleaningCost">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Выезд автомобиля:</div>
                    <div class="cost-value" id="carCost">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Доставка оборудования:</div>
                    <div class="cost-value" id="equipmentCost">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Общая стоимость заказа:</div>
                    <div class="cost-value" id="totalOrderCost">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Скидка:</div>
                    <div class="cost-value" id="discountAmount">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Стоимость после скидки:</div>
                    <div class="cost-value" id="totalAfterDiscount">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Стоимость сотрудников:</div>
                    <div class="cost-value" id="staffCost">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Прибыль/убыток:</div>
                    <div class="cost-value" id="profitLoss">-</div>
                </div>
                
                <div class="cost-item">
                    <div class="cost-label">Маржинальность заказа:</div>
                    <div class="cost-value cost-total" id="marginPercent">-</div>
                </div>
                
                <div id="economyAnalysis">
                    <!-- Экономический анализ -->
                </div>
            </div>
            
            <div class="final-price" id="finalPriceSection" style="display: none;">
                <h3><i class="fas fa-receipt"></i> Итоговая стоимость для клиента</h3>
                <div id="finalPrice">-</div>
                <div class="info-text" style="margin-top: 10px;">Включает все выбранные услуги с учетом скидки</div>
            </div>
            
            <div class="results-card recommendation" id="recommendationCard">
                <h2 class="recommendation-title"><i class="fas fa-clipboard-list"></i> Рекомендации и выводы по заказу</h2>
                <div id="workPlan">
                    <p>После расчета появится подробный план работы для вашего объекта.</p>
                </div>
                <div id="additionalInfo" class="info-text" style="margin-top: 15px;">
                    <!-- Дополнительная информация -->
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p><i class="far fa-copyright"></i> Калькулятор клинингового персонала и химчистки Jullife. Результаты расчета основаны на отраслевых нормативах и являются оценочными. Для точного расчета требуется осмотр объекта.</p>
        </div>
    </div>

    <script>
        // Константы стоимости
        const STAFF_COST_PER_SHIFT = 4500; // Стоимость выхода одного сотрудника
        const MARGIN_TARGET = 0.25; // Целевая маржинальность 25%
        const MIN_HOURS_FOR_EFFICIENCY = 5; // Минимальное количество часов для эффективного использования сотрудника
        const CAR_SERVICE_COST = 4500; // Выезд автомобиля
        const EQUIPMENT_DELIVERY_COST = 1500; // Доставка оборудования
        const MIN_DRY_CLEANING_ORDER = 5000; // Минимальная сумма заказа только химчистки
        
        // Нормативы времени в человеко-часах на м² (основные диапазоны)
        const cleaningNorms = {
            maintenance: { min: 0.15, max: 0.25, avg: 0.2 },
            general_light: { min: 0.3, max: 0.5, avg: 0.4 },
            general_full: { min: 0.7, max: 1.2, avg: 0.95 },
            post_construction: { min: 1.5, max: 3.5, avg: 2.25 }
        };
        
        // Коэффициенты для типа объекта
        const objectCoefficients = {
            apartment: 1.0,     // Квартира
            house: 1.2,         // Дом (больше комнат, санузлов)
            office: 0.7,        // Офис open-space (проще убирать)
            commercial: 1.1,    // Коммерческое помещение
            restaurant: 1.3     // Ресторан (жир, кухня)
        };
        
        // Коэффициенты для степени загрязнения (исправленные)
        const pollutionCoefficients = {
            0.8: { name: "Легкая", multiplier: 0.8, color: "pollution-low" },
            1.0: { name: "Средняя", multiplier: 1.0, color: "pollution-medium" },
            1.3: { name: "Сильная", multiplier: 1.3, color: "pollution-high" },
            2.2: { name: "Очень сильная", multiplier: 2.2, color: "pollution-very-high" },
            2.6: { name: "После стройки/ремонта", multiplier: 2.6, color: "pollution-extreme" }
        };
        
        // Дополнительные услуги клининга
        const additionalServices = [
            { id: 'ironing', name: 'Глажка', time: 0.5, price: 400, unit: '30 мин', type: 'number', icon: 'fas fa-tshirt' },
            { id: 'extra_30min', name: 'Дополнительные 30 мин работы', time: 0.5, price: 500, unit: '30 мин', type: 'number', icon: 'fas fa-clock' },
            { id: 'dishes', name: 'Мытье посуды', time: 0.5, price: 500, unit: 'комплект', type: 'number', icon: 'fas fa-utensils' },
            { id: 'kitchen_module', name: 'Мытье кухонного модуля внутри', time: 0.25, price: 500, unit: 'модуль', type: 'number', icon: 'fas fa-archive' },
            { id: 'panoramic_window', name: 'Мытьё окна панорамного', time: 0.33, price: 800, unit: 'створка', type: 'number', icon: 'fas fa-window-maximize' },
            { id: 'standard_window', name: 'Мытьё окна стандартного', time: 0.2, price: 500, unit: 'створка', type: 'number', icon: 'fas fa-window-restore' },
            { id: 'standard_window_both', name: 'Мытьё окна стандартного (с двух сторон)', time: 0.33, price: 750, unit: 'створка', type: 'number', icon: 'fas fa-exchange-alt' },
            { id: 'oven', name: 'Мытьё духового шкафа внутри', time: 0.42, price: 500, unit: 'шт.', type: 'number', icon: 'fas fa-temperature-high' },
            { id: 'balcony_windows', name: 'Мытье окон на балконе/лоджии', time: 1.5, price: 3000, unit: 'комплекс', type: 'number', icon: 'fas fa-door-closed' },
            { id: 'fridge', name: 'Мытье холодильника внутри', time: 0.42, price: 800, unit: 'шт.', type: 'number', icon: 'fas fa-snowflake' },
            { id: 'pet_litter', name: 'Уборка лотка домашнего питомца', time: 0.13, price: 500, unit: 'лоток', type: 'number', icon: 'fas fa-paw' },
            { id: 'balcony', name: 'Уборка на балконе', time: 0.33, price: 500, unit: 'балкон', type: 'number', icon: 'fas fa-warehouse' },
            { id: 'microwave', name: 'Чистка микроволновой печи (СВЧ) изнутри', time: 0.2, price: 500, unit: 'шт.', type: 'number', icon: 'fas fa-microchip' }
        ];
        
        // Услуги химчистки с ценами с сайта hdclean.ru
        const dryCleaningServices = [
            // Химчистка мягкой мебели
            {
                category: 'soft_furniture',
                name: 'Химчистка мягкой мебели',
                items: [
                    { id: 'sofa_100_140', name: 'Диван прямой 100-140см', price: 2300, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'sofa_150_190', name: 'Диван прямой 150-190см', price: 3300, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'sofa_200_240', name: 'Диван прямой 200-240см', price: 3900, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'sofa_250_290', name: 'Диван прямой 250-290см', price: 4950, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'sofa_300_340', name: 'Диван прямой 300-340см', price: 5950, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'sofa_350_390', name: 'Диван прямой 350-390см', price: 6800, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'sofa_400_440', name: 'Диван прямой 400-440см', price: 7600, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'corner_sofa_180_240', name: 'Диван угловой 180-240см', price: 4300, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'corner_sofa_250_290', name: 'Диван угловой 250-290см', price: 5450, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'corner_sofa_300_340', name: 'Диван угловой 300-340см', price: 6450, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'corner_sofa_350_390', name: 'Диван угловой 350-390см', price: 7450, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'corner_sofa_400_440', name: 'Диван угловой 400-440см', price: 8450, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'u_sofa_300_340', name: 'Диван П-образный 300-340см', price: 7200, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'u_sofa_350_390', name: 'Диван П-образный 350-390см', price: 8200, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'u_sofa_400_440', name: 'Диван П-образный 400-440см', price: 8800, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'u_sofa_450_490', name: 'Диван П-образный 450-490см', price: 9600, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'armchair_50_60', name: 'Кресло 50-60см', price: 1350, unit: 'шт.', icon: 'fas fa-chair' },
                    { id: 'chair_with_back', name: 'Стул с мягкой спинкой', price: 420, unit: 'шт.', icon: 'fas fa-chair' },
                    { id: 'chair_without_back', name: 'Стул без мягкой спинки', price: 350, unit: 'шт.', icon: 'fas fa-chair' },
                    { id: 'kitchen_corner', name: 'Кухонный уголок', price: 2350, unit: 'шт.', icon: 'fas fa-utensils' },
                    { id: 'ottoman_50', name: 'Пуф/Банкетка 50*50см', price: 700, unit: 'шт.', icon: 'fas fa-cube' },
                    { id: 'ottoman_60_100', name: 'Пуф/Банкетка 60-100*60-100см', price: 1100, unit: 'шт.', icon: 'fas fa-cube' },
                    { id: 'sofa_pillow_50', name: 'Подушка дивана 50х50', price: 200, unit: 'шт.', icon: 'fas fa-square' },
                    { id: 'sofa_pillow_100', name: 'Подушка дивана 100х100', price: 400, unit: 'шт.', icon: 'fas fa-square' },
                    { id: 'seat_50_60', name: 'Посадочное место 50*60см', price: 850, unit: 'шт.', icon: 'fas fa-chair' },
                    { id: 'sofa_bed_120_140', name: 'Спальное место дивана 120-140*60-80см', price: 850, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'sofa_bed_folding', name: 'Спальное место дивана (раскладушка)', price: 2550, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'office_chair', name: 'Стул офисный', price: 700, unit: 'шт.', icon: 'fas fa-chair-office' },
                    { id: 'computer_chair', name: 'Офисное кресло, компьютерный стул', price: 700, unit: 'шт.', icon: 'fas fa-chair-office' },
                    { id: 'bed_chair', name: 'Кресло-кровать', price: 2100, unit: 'шт.', icon: 'fas fa-bed' }
                ]
            },
            // Химчистка кожаной мебели
            {
                category: 'leather_furniture',
                name: 'Химчистка кожаной мебели',
                items: [
                    { id: 'leather_sofa_100_140', name: 'Диван прямой 100-140см', price: 2750, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_sofa_150_190', name: 'Диван прямой 150-190см', price: 4100, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_sofa_200_240', name: 'Диван прямой 200-240см', price: 5400, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_sofa_250_290', name: 'Диван прямой 250-290см', price: 6800, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_sofa_300_340', name: 'Диван прямой 300-340см', price: 8200, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_corner_sofa_180_240', name: 'Диван угловой 180-240см', price: 5500, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_corner_sofa_250_290', name: 'Диван угловой 250-290см', price: 6700, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_corner_sofa_300_340', name: 'Диван угловой 300-340см', price: 8900, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_u_sofa_300_340', name: 'Диван П-образный 300-340см', price: 10400, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_u_sofa_350_390', name: 'Диван П-образный 350-390см', price: 11600, unit: 'шт.', icon: 'fas fa-couch' },
                    { id: 'leather_armchair_50_60', name: 'Кресло 50-60см', price: 2100, unit: 'шт.', icon: 'fas fa-chair' },
                    { id: 'leather_chair_with_back', name: 'Стул с мягкой спинкой', price: 800, unit: 'шт.', icon: 'fas fa-chair' },
                    { id: 'leather_chair_without_back', name: 'Стул без мягкой спинки', price: 600, unit: 'шт.', icon: 'fas fa-chair' },
                    { id: 'leather_ottoman', name: 'Пуф/Банкетка', price: 1000, unit: 'шт.', icon: 'fas fa-cube' },
                    { id: 'leather_sofa_bed', name: 'Спальное место кожаного дивана', price: 850, unit: 'шт.', icon: 'fas fa-bed' }
                ]
            },
            // Химчистка матрасов
            {
                category: 'mattresses',
                name: 'Химчистка матрасов',
                items: [
                    { id: 'child_mattress_one_side', name: 'Детский 60-80*100-120см (одна сторона)', price: 850, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'child_mattress_two_sides', name: 'Детский 60-80*100-120см (две стороны)', price: 1650, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'single_mattress_one_side', name: 'Односпальный 80-95*200см (одна сторона)', price: 1650, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'single_mattress_two_sides', name: 'Односпальный 80-95*200см (две стороны)', price: 2550, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'double_mattress_one_side', name: 'Полуторный 100-140*200см (одна сторона)', price: 2550, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'double_mattress_two_sides', name: 'Полуторный 100-140*200см (две стороны)', price: 3750, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'king_mattress_one_side', name: 'Двуспальный 160-200*200см (одна сторона)', price: 3750, unit: 'шт.', icon: 'fas fa-bed' },
                    { id: 'king_mattress_two_sides', name: 'Двуспальный 160-200*200см (две стороны)', price: 5100, unit: 'шт.', icon: 'fas fa-bed' }
                ]
            },
            // Химчистка ковров (цена за м²)
            {
                category: 'carpets',
                name: 'Химчистка ковров (цена за м²)',
                items: [
                    { id: 'carpet_linoleum', name: 'Ковролин', price: 340, unit: 'м²', icon: 'fas fa-rug' },
                    { id: 'carpet_synthetic', name: 'Синтетика', price: 460, unit: 'м²', icon: 'fas fa-rug' },
                    { id: 'carpet_long_pile', name: 'Длинный ворс', price: 700, unit: 'м²', icon: 'fas fa-rug' },
                    { id: 'carpet_cotton_wool', name: 'Хлопок/шерсть', price: 580, unit: 'м²', icon: 'fas fa-rug' }
                ]
            },
            // Химчистка штор
            {
                category: 'curtains',
                name: 'Химчистка штор',
                items: [
                    { id: 'curtain_synthetic', name: 'Штора (синтетика)', price: 450, unit: 'шт.', icon: 'fas fa-border-style' },
                    { id: 'curtain_natural', name: 'Штора (натуральная ткань)', price: 550, unit: 'шт.', icon: 'fas fa-border-style' },
                    { id: 'curtain_with_lining', name: 'Штора с подкладом', price: 800, unit: 'шт.', icon: 'fas fa-border-style' },
                    { id: 'roman_no_lining', name: 'Римская штора без подклада', price: 450, unit: 'шт.', icon: 'fas fa-border-style' },
                    { id: 'roman_with_lining', name: 'Римская штора с подкладом', price: 800, unit: 'шт.', icon: 'fas fa-border-style' },
                    { id: 'fabric_blinds', name: 'Тканевые жалюзи', price: 550, unit: 'шт.', icon: 'fas fa-border-style' },
                    { id: 'valance', name: 'Ламбрекен', price: 450, unit: 'шт.', icon: 'fas fa-border-style' },
                    { id: 'tulle_synthetic', name: 'Тюль (синтетика)', price: 450, unit: 'шт.', icon: 'fas fa-border-style' },
                    { id: 'tulle_natural', name: 'Тюль (натуральная ткань)', price: 450, unit: 'шт.', icon: 'fas fa-border-style' }
                ]
            }
        ];
        
        // Экономически оправданное количество сотрудников для разных типов уборки
        const economicalStaffRecommendations = {
            maintenance: [
                { area: 0, staff: { min: 0, max: 0, rec: 0, minHours: 0, maxHours: 0 } },
                { area: 50, staff: { min: 1, max: 2, rec: 1, minHours: 2.5, maxHours: 5 } },
                { area: 100, staff: { min: 1, max: 2, rec: 1, minHours: 5, maxHours: 10 } },
                { area: 150, staff: { min: 1, max: 2, rec: 1, minHours: 7.5, maxHours: 15 } },
                { area: 200, staff: { min: 2, max: 3, rec: 2, minHours: 10, maxHours: 20 } },
                { area: 300, staff: { min: 2, max: 3, rec: 2, minHours: 15, maxHours: 30 } },
                { area: 450, staff: { min: 2, max: 3, rec: 3, minHours: 22.5, maxHours: 45 } },
                { area: 600, staff: { min: 3, max: 4, rec: 3, minHours: 30, maxHours: 60 } },
                { area: 800, staff: { min: 3, max: 4, rec: 4, minHours: 40, maxHours: 80 } },
                { area: 1000, staff: { min: 4, max: 5, rec: 4, minHours: 50, maxHours: 100 } },
                { area: 1500, staff: { min: 4, max: 6, rec: 5, minHours: 75, maxHours: 150 } }
            ],
            general_light: [
                { area: 0, staff: { min: 0, max: 0, rec: 0, minHours: 0, maxHours: 0 } },
                { area: 50, staff: { min: 1, max: 2, rec: 2, minHours: 5, maxHours: 10 } },
                { area: 100, staff: { min: 2, max: 3, rec: 2, minHours: 10, maxHours: 20 } },
                { area: 150, staff: { min: 2, max: 3, rec: 2, minHours: 15, maxHours: 30 } },
                { area: 200, staff: { min: 2, max: 3, rec: 3, minHours: 20, maxHours: 40 } },
                { area: 300, staff: { min: 3, max: 4, rec: 3, minHours: 30, maxHours: 60 } },
                { area: 450, staff: { min: 3, max: 4, rec: 4, minHours: 45, maxHours: 90 } },
                { area: 600, staff: { min: 4, max: 5, rec: 4, minHours: 60, maxHours: 120 } },
                { area: 800, staff: { min: 4, max: 5, rec: 5, minHours: 80, maxHours: 160 } },
                { area: 1000, staff: { min: 5, max: 6, rec: 5, minHours: 100, maxHours: 200 } },
                { area: 1500, staff: { min: 6, max: 8, rec: 7, minHours: 150, maxHours: 300 } }
            ],
            general_full: [
                { area: 0, staff: { min: 0, max: 0, rec: 0, minHours: 0, maxHours: 0 } },
                { area: 50, staff: { min: 2, max: 2, rec: 2, minHours: 12.5, maxHours: 25 } },
                { area: 100, staff: { min: 2, max: 3, rec: 3, minHours: 25, maxHours: 50 } },
                { area: 150, staff: { min: 3, max: 4, rec: 3, minHours: 37.5, maxHours: 75 } },
                { area: 200, staff: { min: 3, max: 4, rec: 4, minHours: 50, maxHours: 100 } },
                { area: 300, staff: { min: 4, max: 5, rec: 4, minHours: 75, maxHours: 150 } },
                { area: 450, staff: { min: 4, max: 5, rec: 4, minHours: 112.5, maxHours: 225 } },
                { area: 600, staff: { min: 5, max: 6, rec: 6, minHours: 150, maxHours: 300 } },
                { area: 800, staff: { min: 5, max: 6, rec: 6, minHours: 200, maxHours: 400 } },
                { area: 1000, staff: { min: 6, max: 7, rec: 6, minHours: 250, maxHours: 500 } },
                { area: 1500, staff: { min: 8, max: 10, rec: 9, minHours: 375, maxHours: 750 } }
            ],
            post_construction: [
                { area: 0, staff: { min: 0, max: 0, rec: 0, minHours: 0, maxHours: 0 } },
                { area: 50, staff: { min: 3, max: 4, rec: 4, minHours: 25, maxHours: 50 } },
                { area: 100, staff: { min: 4, max: 4, rec: 4, minHours: 50, maxHours: 100 } },
                { area: 150, staff: { min: 4, max: 5, rec: 5, minHours: 75, maxHours: 150 } },
                { area: 200, staff: { min: 4, max: 5, rec: 5, minHours: 100, maxHours: 200 } },
                { area: 300, staff: { min: 5, max: 6, rec: 6, minHours: 150, maxHours: 300 } },
                { area: 450, staff: { min: 5, max: 6, rec: 6, minHours: 225, maxHours: 450 } },
                { area: 600, staff: { min: 6, max: 8, rec: 8, minHours: 300, maxHours: 600 } },
                { area: 800, staff: { min: 6, max: 8, rec: 8, minHours: 400, maxHours: 800 } },
                { area: 1000, staff: { min: 7, max: 9, rec: 8, minHours: 500, maxHours: 1000 } },
                { area: 1500, staff: { min: 10, max: 12, rec: 11, minHours: 750, maxHours: 1500 } }
            ]
        };
        
        // Коэффициенты сложности задачи для отображения
        const complexityLabels = {
            low: { text: "Низкая", badge: "low-complexity", desc: "Простая задача, можно выполнить быстро" },
            medium: { text: "Средняя", badge: "medium-complexity", desc: "Стандартная задача, требует планирования" },
            high: { text: "Высокая", badge: "high-complexity", desc: "Сложная задача, требует опытной бригады" },
            veryHigh: { text: "Очень высокая", badge: "high-complexity", desc: "Очень сложная задача, требуется спецоборудование" }
        };
        
        // DOM элементы
        const areaInput = document.getElementById('area');
        const areaSlider = document.getElementById('areaSlider');
        const objectTypeSelect = document.getElementById('objectType');
        const pollutionLevelSelect = document.getElementById('pollutionLevel');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const servicesContainer = document.getElementById('servicesContainer');
        const additionalServicesTotal = document.getElementById('additionalServicesTotal');
        const economyModeToggle = document.getElementById('economyMode');
        const economyStatus = document.getElementById('economyStatus');
        const costSection = document.getElementById('costSection');
        const discountInput = document.getElementById('discount');
        const discountSlider = document.getElementById('discountSlider');
        const carServiceCheckbox = document.getElementById('carService');
        const equipmentDeliveryCheckbox = document.getElementById('equipmentDelivery');
        const finalPriceSection = document.getElementById('finalPriceSection');
        const dryCleaningContainer = document.getElementById('dryCleaningContainer');
        const dryCleaningTotal = document.getElementById('dryCleaningTotal');
        
        // Элементы для выбора количества сотрудников
        const staffModeAuto = document.getElementById('staffModeAuto');
        const staffModeManual = document.getElementById('staffModeManual');
        const manualStaffSelection = document.getElementById('manualStaffSelection');
        const autoStaffInfo = document.getElementById('autoStaffInfo');
        const decreaseStaffBtn = document.getElementById('decreaseStaff');
        const increaseStaffBtn = document.getElementById('increaseStaff');
        const staffCountDisplay = document.getElementById('staffCount');
        const staffRecommendation = document.getElementById('staffRecommendation');
        const recommendedStaffCount = document.getElementById('recommendedStaffCount');
        
        // Элементы для отображения результатов
        const baseTimeElement = document.getElementById('baseTime');
        const additionalTimeElement = document.getElementById('additionalTime');
        const dryCleaningCostResultElement = document.getElementById('dryCleaningCostResult');
        const totalTimeElement = document.getElementById('totalTime');
        const staffRequiredElement = document.getElementById('staffRequired');
        const complexityLevelElement = document.getElementById('complexityLevel');
        const complexityBadgeElement = document.getElementById('complexityBadge');
        const timePerWorkerElement = document.getElementById('timePerWorker');
        const mainCleaningCostResultElement = document.getElementById('mainCleaningCostResult');
        const recommendationMainElement = document.getElementById('recommendationMain');
        const recommendationCardElement = document.getElementById('recommendationCard');
        const workPlanElement = document.getElementById('workPlan');
        const additionalInfoElement = document.getElementById('additionalInfo');
        
        // Элементы для отображения стоимости
        const costStaffElement = document.getElementById('costStaff');
        const mainCleaningCostElement = document.getElementById('mainCleaningCost');
        const additionalCostElement = document.getElementById('additionalCost');
        const dryCleaningCostElement = document.getElementById('dryCleaningCost');
        const carCostElement = document.getElementById('carCost');
        const equipmentCostElement = document.getElementById('equipmentCost');
        const totalOrderCostElement = document.getElementById('totalOrderCost');
        const discountAmountElement = document.getElementById('discountAmount');
        const totalAfterDiscountElement = document.getElementById('totalAfterDiscount');
        const staffCostElement = document.getElementById('staffCost');
        const profitLossElement = document.getElementById('profitLoss');
        const marginPercentElement = document.getElementById('marginPercent');
        const economyAnalysisElement = document.getElementById('economyAnalysis');
        const finalPriceElement = document.getElementById('finalPrice');
        
        // Переменные для хранения данных
        let currentRecommendedStaff = 2;
        let manualStaffCount = 2;
        
        // Функция форматирования времени
        function formatTime(hours) {
            if (hours >= 1) {
                const wholeHours = Math.floor(hours);
                const minutes = Math.round((hours - wholeHours) * 60);
                
                if (minutes === 0) {
                    return `${wholeHours} ч`;
                } else if (wholeHours === 0) {
                    return `${minutes} мин`;
                } else {
                    return `${wholeHours} ч ${minutes} мин`;
                }
            } else {
                const minutes = Math.round(hours * 60);
                return `${minutes} мин`;
            }
        }
        
        // Функция форматирования денег
        function formatMoney(amount) {
            return amount.toLocaleString('ru-RU') + ' руб.';
        }
        
        // Генерация списка дополнительных услуг клининга
        function generateServicesList() {
            servicesContainer.innerHTML = '';
            
            additionalServices.forEach(service => {
                const serviceElement = document.createElement('div');
                serviceElement.className = 'service-item';
                serviceElement.id = `service-${service.id}`;
                
                serviceElement.innerHTML = `
                    <div class="service-info">
                        <div class="service-name">
                            <i class="${service.icon}"></i> ${service.name}
                        </div>
                        <div class="service-details">
                            <span class="service-time"><i class="far fa-clock"></i> ${service.time} ч / ед.</span>
                            <span class="service-price"><i class="fas fa-ruble-sign"></i> ${formatMoney(service.price)} / ${service.unit}</span>
                        </div>
                    </div>
                    <div class="service-controls">
                        <input type="number" min="0" max="50" value="0" class="service-quantity" 
                               id="qty-${service.id}" 
                               data-time="${service.time}" 
                               data-price="${service.price}" 
                               data-unit="${service.unit}"
                               title="Введите количество (единицы: ${service.unit})"
                               placeholder="0">
                        <div class="service-total" id="total-${service.id}">0 руб</div>
                    </div>
                `;
                
                servicesContainer.appendChild(serviceElement);
            });
            
            // Добавляем обработчики событий для пересчета при изменении
            addServiceEventListeners();
        }
        
        // Генерация списка услуг химчистки
        function generateDryCleaningList() {
            dryCleaningContainer.innerHTML = '';
            
            dryCleaningServices.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'dry-cleaning-category';
                
                let categoryHTML = `
                    <h3 class="dry-cleaning-category-title">
                        <i class="fas ${category.items[0].icon}"></i> ${category.name}
                    </h3>
                    <div class="category-items">
                `;
                
                category.items.forEach(item => {
                    categoryHTML += `
                        <div class="dry-cleaning-item" id="drycleaning-${item.id}">
                            <div class="dry-cleaning-info">
                                <div class="dry-cleaning-name">
                                    <i class="${item.icon}"></i> ${item.name}
                                </div>
                                <div class="dry-cleaning-details">
                                    <span class="dry-cleaning-price"><i class="fas fa-ruble-sign"></i> ${formatMoney(item.price)} / ${item.unit}</span>
                                </div>
                            </div>
                            <div class="service-controls">
                                <input type="number" min="0" max="50" value="0" class="service-quantity" 
                                       id="qty-dry-${item.id}" 
                                       data-price="${item.price}" 
                                       data-unit="${item.unit}"
                                       data-category="${category.category}"
                                       data-item-name="${item.name}"
                                       title="Введите количество (единицы: ${item.unit})"
                                       placeholder="0">
                                <div class="service-total" id="total-dry-${item.id}">0 руб</div>
                            </div>
                        </div>
                    `;
                });
                
                categoryHTML += `</div>`;
                categoryElement.innerHTML = categoryHTML;
                dryCleaningContainer.appendChild(categoryElement);
            });
            
            // Добавляем обработчики событий для услуг химчистки
            addDryCleaningEventListeners();
        }
        
        // Добавление обработчиков событий для дополнительных услуг клининга
        function addServiceEventListeners() {
            additionalServices.forEach(service => {
                const input = document.getElementById(`qty-${service.id}`);
                if (input) {
                    input.addEventListener('input', function() {
                        updateServiceTotal();
                        scheduleCalculation();
                    });
                }
            });
        }
        
        // Добавление обработчиков событий для услуг химчистки
        function addDryCleaningEventListeners() {
            dryCleaningServices.forEach(category => {
                category.items.forEach(item => {
                    const input = document.getElementById(`qty-dry-${item.id}`);
                    if (input) {
                        input.addEventListener('input', function() {
                            updateDryCleaningTotal();
                            scheduleCalculation();
                        });
                    }
                });
            });
        }
        
        // Обновление отображения времени и стоимости для дополнительных услуг клининга
        function updateServiceTotal() {
            let totalAdditionalTime = 0;
            let totalAdditionalCost = 0;
            
            additionalServices.forEach(service => {
                let serviceTime = 0;
                let serviceCost = 0;
                const totalElement = document.getElementById(`total-${service.id}`);
                const input = document.getElementById(`qty-${service.id}`);
                
                if (input && input.value) {
                    const quantity = parseInt(input.value) || 0;
                    serviceTime = service.time * quantity;
                    serviceCost = service.price * quantity;
                }
                
                if (totalElement) {
                    totalElement.textContent = serviceCost > 0 ? `${formatMoney(serviceCost)}` : '0 руб';
                    if (serviceCost > 0) {
                        totalElement.style.color = '#28a745';
                    } else {
                        totalElement.style.color = '#182848';
                    }
                }
                
                totalAdditionalTime += serviceTime;
                totalAdditionalCost += serviceCost;
            });
            
            additionalServicesTotal.innerHTML = `<i class="fas fa-receipt"></i> Дополнительные услуги клининга: ${totalAdditionalTime.toFixed(1)} часов, ${formatMoney(totalAdditionalCost)}`;
            return { totalTime: totalAdditionalTime, totalCost: totalAdditionalCost };
        }
        
        // Обновление отображения стоимости услуг химчистки (без автоматического применения минимума 3000)
        function updateDryCleaningTotal() {
            let totalDryCleaningCost = 0;
            
            dryCleaningServices.forEach(category => {
                category.items.forEach(item => {
                    let serviceCost = 0;
                    const totalElement = document.getElementById(`total-dry-${item.id}`);
                    const input = document.getElementById(`qty-dry-${item.id}`);
                    
                    if (input && input.value) {
                        const quantity = parseInt(input.value) || 0;
                        serviceCost = item.price * quantity;
                    }
                    
                    if (totalElement) {
                        totalElement.textContent = serviceCost > 0 ? `${formatMoney(serviceCost)}` : '0 руб';
                        if (serviceCost > 0) {
                            totalElement.style.color = '#9c27b0';
                        } else {
                            totalElement.style.color = '#182848';
                        }
                    }
                    
                    totalDryCleaningCost += serviceCost;
                });
            });
            
            dryCleaningTotal.innerHTML = `<i class="fas fa-receipt"></i> Услуги химчистки: ${formatMoney(totalDryCleaningCost)}`;
            
            return {
                totalCost: totalDryCleaningCost
            };
        }
        
        // Получение стоимости логистических услуг
        function getLogisticsCost() {
            let logisticsCost = 0;
            
            if (carServiceCheckbox && carServiceCheckbox.checked) {
                logisticsCost += CAR_SERVICE_COST;
            }
            
            if (equipmentDeliveryCheckbox && equipmentDeliveryCheckbox.checked) {
                logisticsCost += EQUIPMENT_DELIVERY_COST;
            }
            
            return {
                total: logisticsCost,
                car: carServiceCheckbox.checked ? CAR_SERVICE_COST : 0,
                equipment: equipmentDeliveryCheckbox.checked ? EQUIPMENT_DELIVERY_COST : 0
            };
        }
        
        // Инициализация выбора количества сотрудников
        function initStaffSelection() {
            staffCountDisplay.textContent = manualStaffCount;
            
            // Обработчики для переключения режима
            staffModeAuto.addEventListener('change', function() {
                if (this.checked) {
                    manualStaffSelection.style.display = 'none';
                    autoStaffInfo.style.display = 'block';
                    scheduleCalculation();
                }
            });
            
            staffModeManual.addEventListener('change', function() {
                if (this.checked) {
                    manualStaffSelection.style.display = 'block';
                    autoStaffInfo.style.display = 'none';
                    scheduleCalculation();
                }
            });
            
            // Обработчики для кнопок изменения количества
            decreaseStaffBtn.addEventListener('click', function() {
                if (manualStaffCount > 1) {
                    manualStaffCount--;
                    staffCountDisplay.textContent = manualStaffCount;
                    updateStaffRecommendation();
                    scheduleCalculation();
                }
            });
            
            increaseStaffBtn.addEventListener('click', function() {
                if (manualStaffCount < 10) {
                    manualStaffCount++;
                    staffCountDisplay.textContent = manualStaffCount;
                    updateStaffRecommendation();
                    scheduleCalculation();
                }
            });
            
            // Обновление рекомендации по количеству сотрудников
            function updateStaffRecommendation() {
                recommendedStaffCount.textContent = currentRecommendedStaff;
                
                if (staffModeManual.checked) {
                    if (manualStaffCount < currentRecommendedStaff) {
                        staffRecommendation.innerHTML = `Рекомендуется: <span class="staff-warning">${currentRecommendedStaff}</span> сотрудников. Вы выбрали: <span class="staff-warning">${manualStaffCount}</span> (меньше рекомендованного)`;
                    } else if (manualStaffCount > currentRecommendedStaff) {
                        staffRecommendation.innerHTML = `Рекомендуется: <span class="staff-ok">${currentRecommendedStaff}</span> сотрудников. Вы выбрали: <span class="staff-ok">${manualStaffCount}</span> (больше рекомендованного)`;
                    } else {
                        staffRecommendation.innerHTML = `Рекомендуется: <span class="staff-ok">${currentRecommendedStaff}</span> сотрудников. Вы выбрали: <span class="staff-ok">${manualStaffCount}</span> (оптимально)`;
                    }
                } else {
                    staffRecommendation.innerHTML = `Рекомендуется: <span class="staff-ok">${currentRecommendedStaff}</span> сотрудников`;
                }
            }
            
            window.updateStaffRecommendation = updateStaffRecommendation;
        }
        
        // Получение цены из таблицы Excel для клининга
        function getPriceFromTable(cleaningType, area) {
            if (area <= 0) return 0;
            
            const roundedArea = Math.floor(area / 10) * 10;
            let price = 0;
            
            switch(cleaningType) {
                case 'maintenance':
                    if (area <= 30) return 4290;
                    if (area < 100) {
                        const steps = Math.floor((area - 30) / 10);
                        return 4290 + steps * 200;
                    } else {
                        const price90 = 4290 + 6 * 200;
                        const steps = Math.floor((area - 90) / 10);
                        return price90 + steps * 450;
                    }
                    
                case 'general_light':
                    if (area <= 30) return 5990;
                    const stepsLight = Math.floor((area - 30) / 10);
                    return 5990 + stepsLight * 1200;
                    
                case 'general_full':
                    if (area <= 30) return 12490;
                    if (area < 100) {
                        const steps = Math.floor((area - 30) / 10);
                        return 12490 + steps * 1500;
                    } else {
                        const price90 = 12490 + 6 * 1500;
                        const steps = Math.floor((area - 90) / 10);
                        return price90 + steps * 1000;
                    }
                    
                case 'post_construction':
                    if (area <= 30) return 13990;
                    const stepsPost = Math.floor((area - 30) / 10);
                    return 13990 + stepsPost * 1500;
                    
                default:
                    return 0;
            }
        }
        
        // Функция получения экономически оправданного количества сотрудников
        function getEconomicalStaff(cleaningType, area, totalManHours, additionalTimeHours, additionalCost, economyMode) {
            // Если площадь 0, то используем только totalManHours (который равен additionalTimeHours)
            if (area <= 0) {
                if (totalManHours <= 0) {
                    return { min: 0, max: 0, rec: 0 };
                }
                let rec = Math.ceil(totalManHours / 8);
                if (rec < 1) rec = 1;
                return { min: rec, max: rec, rec: rec };
            }
            
            const recommendations = economicalStaffRecommendations[cleaningType];
            if (!recommendations) return { min: 1, max: 2, rec: 2 };
            
            // Упрощенная логика определения рекомендаций
            let recommendedStaff = 2;
            
            if (area < 100) {
                recommendedStaff = cleaningType === 'maintenance' ? 1 : 2;
            } else if (area < 200) {
                recommendedStaff = cleaningType === 'maintenance' ? 2 : 2;
            } else if (area < 400) {
                recommendedStaff = cleaningType === 'maintenance' ? 2 : 3;
            } else {
                recommendedStaff = cleaningType === 'maintenance' ? 3 : 4;
            }
            
            // Для уборки после ремонта всегда больше сотрудников
            if (cleaningType === 'post_construction') {
                recommendedStaff = Math.max(recommendedStaff, 3);
            }
            
            // Экономический режим может уменьшить количество сотрудников
            if (economyMode && cleaningType === 'maintenance' && area < 150 && additionalTimeHours < 2) {
                recommendedStaff = 1;
            }
            
            return {
                min: Math.max(1, recommendedStaff - 1),
                max: recommendedStaff + 1,
                rec: recommendedStaff
            };
        }
        
        // Функция определения сложности задачи
        function getComplexity(totalHours, staff, cleaningType) {
            if (staff === 0 || totalHours === 0) return complexityLabels.low;
            
            const hoursPerWorker = totalHours / staff;
            
            if (hoursPerWorker < 4) return complexityLabels.low;
            if (hoursPerWorker < 8) return complexityLabels.medium;
            if (hoursPerWorker < 12) return complexityLabels.high;
            return complexityLabels.veryHigh;
        }
        
        // Функция расчета стоимости с учетом маржинальности - ИСПРАВЛЕННАЯ
        function calculateCost(staffRequired, timePerWorker, totalManHours, additionalCost, dryCleaningCost, cleaningType, area, economyMode, discountPercent, logisticsCost, objectCoefficient, pollutionCoefficient) {
            // Получаем базовую цену из таблицы (для клининга)
            const baseTablePrice = getPriceFromTable(cleaningType, area);
            
            // Применяем коэффициент объекта И коэффициент загрязнения к цене
            let mainCleaningPrice = Math.round(baseTablePrice * objectCoefficient * pollutionCoefficient);
            
            // Общая стоимость заказа до скидки
            const orderTotalBeforeDiscount = mainCleaningPrice + additionalCost + dryCleaningCost + logisticsCost.total;
            
            // Рассчитываем скидку
            const discountAmount = Math.round(orderTotalBeforeDiscount * (discountPercent / 100));
            const orderTotal = orderTotalBeforeDiscount - discountAmount;
            
            // Стоимость сотрудников (только для клининга, химчистка - отдельная услуга)
            const staffCost = staffRequired * STAFF_COST_PER_SHIFT;
            
            // Маржинальность (относительно стоимости после скидки)
            const profit = orderTotal - staffCost;
            const margin = orderTotal > 0 ? profit / orderTotal : 0;
            const marginPercent = (margin * 100).toFixed(1);
            
            // Обновляем элементы стоимости
            costStaffElement.textContent = `${staffRequired} чел.`;
            mainCleaningCostElement.textContent = `${formatMoney(mainCleaningPrice)}`;
            additionalCostElement.textContent = formatMoney(additionalCost);
            dryCleaningCostElement.textContent = formatMoney(dryCleaningCost);
            carCostElement.textContent = logisticsCost.car > 0 ? formatMoney(logisticsCost.car) : '0 руб.';
            equipmentCostElement.textContent = logisticsCost.equipment > 0 ? formatMoney(logisticsCost.equipment) : '0 руб.';
            totalOrderCostElement.textContent = formatMoney(orderTotalBeforeDiscount);
            discountAmountElement.textContent = `-${formatMoney(discountAmount)} (${discountPercent}%)`;
            totalAfterDiscountElement.textContent = formatMoney(orderTotal);
            staffCostElement.textContent = formatMoney(staffCost);
            profitLossElement.textContent = formatMoney(profit);
            marginPercentElement.textContent = `${marginPercent}%`;
            
            // Обновляем стоимость в результатах
            mainCleaningCostResultElement.textContent = `${formatMoney(mainCleaningPrice)}`;
            dryCleaningCostResultElement.textContent = `${formatMoney(dryCleaningCost)}`;
            
            // Цвет для маржинальности
            if (margin < 0) {
                marginPercentElement.style.color = '#dc3545';
                profitLossElement.style.color = '#dc3545';
            } else if (margin < MARGIN_TARGET) {
                marginPercentElement.style.color = '#fd7e14';
                profitLossElement.style.color = '#fd7e14';
            } else {
                marginPercentElement.style.color = '#28a745';
                profitLossElement.style.color = '#28a745';
            }
            
            // Показываем раздел стоимости
            costSection.style.display = 'block';
            
            // Показываем итоговую стоимость для клиента
            finalPriceSection.style.display = 'block';
            finalPriceElement.innerHTML = `<span style="font-size: 1.5rem; color: #28a745;">${formatMoney(orderTotal)}</span>`;
            if (discountPercent > 0) {
                finalPriceElement.innerHTML += `<br><span style="font-size: 0.9rem; color: #666;">Без скидки: ${formatMoney(orderTotalBeforeDiscount)}</span>`;
            }
            
            // Анализ экономической эффективности
            let economyAnalysis = '';
            
            if (economyMode) {
                // Проверка на убыточность
                if (orderTotal < staffCost) {
                    economyAnalysis += `
                        <div class="economy-warning">
                            <i class="fas fa-exclamation-triangle"></i> <strong>УБЫТОЧНЫЙ ЗАКАЗ:</strong> Стоимость заказа (${formatMoney(orderTotal)}) меньше стоимости сотрудников (${formatMoney(staffCost)}).
                            Убыток: ${formatMoney(staffCost - orderTotal)}.
                        </div>
                    `;
                } 
                // Проверка на низкую маржинальность
                else if (margin < MARGIN_TARGET) {
                    economyAnalysis += `
                        <div class="economy-warning">
                            <i class="fas fa-exclamation-circle"></i> <strong>НИЗКАЯ МАРЖИНАЛЬНОСТЬ:</strong> Фактическая маржа ${marginPercent}% ниже целевой ${MARGIN_TARGET*100}%.
                            Для достижения целевой маржи стоимость заказа должна быть не менее ${formatMoney(staffCost / (1 - MARGIN_TARGET))}.
                        </div>
                    `;
                } else {
                    economyAnalysis += `
                        <div class="economy-ok">
                            <i class="fas fa-check-circle"></i> <strong>ХОРОШАЯ МАРЖИНАЛЬНОСТЬ:</strong> Фактическая маржа ${marginPercent}% превышает целевую ${MARGIN_TARGET*100}%.
                            Прибыль: ${formatMoney(profit)}.
                        </div>
                    `;
                }
                
                // Рекомендации по оптимизации
                if (orderTotal < staffCost) {
                    economyAnalysis += `
                        <div class="economy-option">
                            <i class="fas fa-lightbulb"></i> <strong>Рекомендация:</strong> Отказаться от заказа или:
                            <ul style="margin: 5px 0 5px 20px;">
                                <li>Уменьшить скидку</li>
                                <li>Увеличить стоимость до ${formatMoney(staffCost * 1.1)}</li>
                                <li>Уменьшить количество сотрудников до ${Math.max(1, Math.floor(orderTotal / STAFF_COST_PER_SHIFT))}</li>
                                <li>Добавить дополнительные услуги или химчистку</li>
                            </ul>
                        </div>
                    `;
                }
                
                // Информация о маржинальности
                economyAnalysis += `
                    <div class="info-text" style="margin-top: 10px;">
                        <i class="fas fa-info-circle"></i> <strong>Расчет маржинальности:</strong><br>
                        • Цена заказа (после скидки): ${formatMoney(orderTotal)}<br>
                        • Стоимость сотрудников: ${formatMoney(staffCost)}<br>
                        • Прибыль: ${formatMoney(profit)}<br>
                        • Маржинальность: ${marginPercent}% (цель: ${MARGIN_TARGET*100}%)<br>
                        • Минимальная цена для безубыточности: ${formatMoney(staffCost)}<br>
                        • Минимальная цена для целевой маржи: ${formatMoney(staffCost / (1 - MARGIN_TARGET))}
                    </div>
                `;
            }
            
            economyAnalysisElement.innerHTML = economyAnalysis;
        }
        
        // Основная функция расчета - ИСПРАВЛЕННАЯ ВЕРСИЯ
        function performCalculation() {
            // Получение значений из формы
            const area = parseFloat(areaInput.value);
            const objectType = objectTypeSelect.value;
            const pollutionLevelValue = pollutionLevelSelect.value;
            const pollutionLevel = parseFloat(pollutionLevelValue);
            const economyMode = economyModeToggle.checked;
            const discountPercent = parseFloat(discountInput.value);
            
            // Получение выбранного типа уборки
            const cleaningType = document.querySelector('input[name="cleaningType"]:checked').value;
            
            // Получаем коэффициент объекта
            const objectCoefficient = objectCoefficients[objectType] || 1.0;
            
            // Получаем коэффициент загрязнения
            const pollutionCoefficient = pollutionCoefficients[pollutionLevel] ? pollutionCoefficients[pollutionLevel].multiplier : 1.0;
            
            // Расчет времени и стоимости дополнительных услуг клининга
            const additionalResult = updateServiceTotal();
            const additionalTimeHours = additionalResult.totalTime;
            const additionalCost = additionalResult.totalCost;
            
            // Расчет стоимости услуг химчистки (без применения минимума)
            const dryCleaningResult = updateDryCleaningTotal();
            let dryCleaningCost = dryCleaningResult.totalCost;
            
            // Проверяем, нужно ли применять минимальный заказ (только если нет клининга)
            if (dryCleaningCost > 0 && area <= 0 && additionalCost <= 0 && dryCleaningCost < MIN_DRY_CLEANING_ORDER) {
                dryCleaningCost = MIN_DRY_CLEANING_ORDER;
                // Обновляем отображение с учетом минимального заказа
                dryCleaningTotal.innerHTML = `<i class="fas fa-receipt"></i> Услуги химчистки: ${formatMoney(dryCleaningCost)} (минимальный заказ)`;
            }
            
            // Получение стоимости логистических услуг
            const logisticsCost = getLogisticsCost();
            
            // Базовый расчет человеко-часов по нормативам
            let baseManHours = 0;
            if (area > 0) {
                const norm = cleaningNorms[cleaningType];
                baseManHours = norm.avg * area;
            }
            
            // Применение коэффициентов - ВАЖНО: загрязнение применяется и к времени, и к стоимости
            const adjustedManHours = baseManHours * objectCoefficient * pollutionCoefficient;
            
            // Общее количество человеко-часов
            const totalManHours = adjustedManHours + additionalTimeHours;
            
            // Получение экономически оправданного количества сотрудников
            const recommendedStaff = getEconomicalStaff(cleaningType, area, totalManHours, additionalTimeHours, additionalCost, economyMode);
            
            // Сохраняем рекомендованное количество сотрудников
            currentRecommendedStaff = recommendedStaff.rec;
            if (window.updateStaffRecommendation) {
                window.updateStaffRecommendation();
            }
            
            // Итоговое количество сотрудников
            let staffRequired;
            if (staffModeManual.checked) {
                staffRequired = manualStaffCount;
            } else {
                staffRequired = recommendedStaff.rec;
            }
            
            // Время на одного сотрудника
            let timePerWorker = 0;
            if (staffRequired > 0) {
                timePerWorker = totalManHours / staffRequired;
            }
            
            // Определение сложности задачи
            const complexity = getComplexity(totalManHours, staffRequired, cleaningType);
            
            // Обновление интерфейса с результатами
            baseTimeElement.textContent = `${adjustedManHours.toFixed(1)} чел-ч`;
            additionalTimeElement.textContent = `${additionalTimeHours.toFixed(1)} чел-ч (${formatMoney(additionalCost)})`;
            totalTimeElement.textContent = `${totalManHours.toFixed(1)} чел-ч`;
            staffRequiredElement.textContent = `${staffRequired} чел.`;
            complexityLevelElement.textContent = complexity.text;
            complexityBadgeElement.textContent = complexity.text;
            complexityBadgeElement.className = `complexity-badge ${complexity.badge}`;
            timePerWorkerElement.textContent = formatTime(timePerWorker);
            
            // Формирование рекомендаций
            let recommendationText = "";
            
            if (area <= 0) {
                recommendationText = `<i class="fas fa-home"></i> Площадь помещения: 0 м². Расчет выполнен только для дополнительных услуг.`;
            } else if (staffRequired === 1) {
                recommendationText = `<i class="fas fa-user-check"></i> Для уборки ${area} м² ${staffModeManual.checked ? 'вы выбрали' : 'экономически выгодно использовать'} 1 сотрудника. Работа займет ${formatTime(timePerWorker)}.`;
            } else {
                recommendationText = `<i class="fas fa-users"></i> Для уборки ${area} м² ${staffModeManual.checked ? 'вы выбрали' : 'рекомендуется'} бригада из ${staffRequired} сотрудников. Каждый отработает ${formatTime(timePerWorker)}.`;
            }
            
            // Добавляем информацию о коэффициентах
            const pollutionName = pollutionCoefficients[pollutionLevel] ? pollutionCoefficients[pollutionLevel].name : "Средняя";
            recommendationText += ` <span style="color: #6c757d;"><i class="fas fa-tint"></i> Степень загрязнения: ${pollutionName} (коэфф. ×${pollutionCoefficient})</span>`;
            
            // Добавляем информацию о химчистке, если она выбрана
            if (dryCleaningCost > 0) {
                recommendationText += ` <span style="color: #9c27b0;"><i class="fas fa-tshirt"></i> В заказ включены услуги химчистки на сумму ${formatMoney(dryCleaningCost)}.</span>`;
                
                // Проверяем минимальный заказ химчистки (только если нет клининга)
                if (area <= 0 && additionalCost <= 0 && dryCleaningCost < MIN_DRY_CLEANING_ORDER) {
                    recommendationText += ` <span style="color: #d9534f;"><i class="fas fa-exclamation-triangle"></i> Внимание: минимальная сумма заказа только химчистки составляет ${formatMoney(MIN_DRY_CLEANING_ORDER)}. Стоимость заказа была увеличена до минимальной.</span>`;
                }
            }
            
            if (discountPercent > 0) {
                recommendationText += ` <span style="color: #17a2b8;"><i class="fas fa-tag"></i> Применена общая скидка: ${discountPercent}%.</span>`;
            }
            
            if (logisticsCost.total > 0) {
                recommendationText += ` <span style="color: #ffc107;"><i class="fas fa-truck"></i> Включены логистические услуги: ${formatMoney(logisticsCost.total)}.</span>`;
            }
            
            recommendationMainElement.innerHTML = recommendationText;
            
            // Расчет стоимости с учетом маржинальности - ПЕРЕДАЕМ pollutionCoefficient
            calculateCost(staffRequired, timePerWorker, totalManHours, additionalCost, dryCleaningCost, cleaningType, area, economyMode, discountPercent, logisticsCost, objectCoefficient, pollutionCoefficient);
            
            // Формирование плана работы
            generateWorkPlan(area, cleaningType, objectType, staffRequired, totalManHours, timePerWorker, additionalTimeHours, additionalCost, dryCleaningCost, economyMode, discountPercent, logisticsCost);
            
            // Дополнительная информация
            additionalInfoElement.innerHTML = `<i class="fas fa-info-circle"></i> <strong>${complexity.desc}</strong> ${timePerWorker > 8 ? "Рекомендуется разбить работу на несколько дней или увеличить бригаду." : ""}`;
            
            // Показать карточку с рекомендациями
            recommendationCardElement.style.display = 'block';
        }
        
        // Функция генерации плана работы - обновленная для отображения коэффициентов
        function generateWorkPlan(area, cleaningType, objectType, staffRequired, totalManHours, timePerWorker, additionalTimeHours, additionalCost, dryCleaningCost, economyMode, discountPercent, logisticsCost) {
            let planHTML = '<div class="work-plan">';
            
            // Получаем значения коэффициентов
            const objectCoefficient = objectCoefficients[objectType] || 1.0;
            const pollutionLevelValue = pollutionLevelSelect.value;
            const pollutionCoefficient = pollutionCoefficients[pollutionLevelValue] ? pollutionCoefficients[pollutionLevelValue].multiplier : 1.0;
            const pollutionName = pollutionCoefficients[pollutionLevelValue] ? pollutionCoefficients[pollutionLevelValue].name : "Средняя";
            
            // Определение типа уборки для отображения
            let cleaningTypeText = "";
            switch(cleaningType) {
                case 'maintenance': cleaningTypeText = "поддерживающей уборки"; break;
                case 'general_light': cleaningTypeText = "генеральной уборки лайт"; break;
                case 'general_full': cleaningTypeText = "генеральной уборки (полной)"; break;
                case 'post_construction': cleaningTypeText = "уборки после ремонта"; break;
            }
            
            if (area > 0) {
                planHTML += `<p><strong>План для ${cleaningTypeText} площадью ${area} м²:</strong></p>`;
            } else {
                planHTML += `<p><strong>План для дополнительных услуг:</strong></p>`;
            }
            
            // Информация о коэффициентах
            planHTML += `<div class="info-text">`;
            planHTML += `<i class="fas fa-building"></i> Тип объекта: ${objectTypeSelect.options[objectTypeSelect.selectedIndex].text} (коэфф. ×${objectCoefficient.toFixed(1)})<br>`;
            planHTML += `<i class="fas fa-tint"></i> Степень загрязнения: ${pollutionName} (коэфф. ×${pollutionCoefficient.toFixed(1)})`;
            planHTML += `</div>`;
            
            // Информация о режиме выбора персонала
            if (staffModeManual.checked) {
                planHTML += `<div class="${manualStaffCount < currentRecommendedStaff ? 'economy-warning' : manualStaffCount > currentRecommendedStaff ? 'economy-ok' : 'info-text'}">`;
                planHTML += `<i class="fas fa-user-edit"></i> Ручной выбор персонала: ${manualStaffCount} сотрудников (рекомендовано: ${currentRecommendedStaff})`;
                planHTML += `</div>`;
            } else {
                planHTML += `<div class="info-text">`;
                planHTML += `<i class="fas fa-robot"></i> Автоматический подбор персонала: ${staffRequired} сотрудников`;
                planHTML += `</div>`;
            }
            
            // Информация о химчистке
            if (dryCleaningCost > 0) {
                planHTML += `<div class="info-text">`;
                planHTML += `<i class="fas fa-tshirt"></i> <strong>Услуги химчистки включены в заказ:</strong> ${formatMoney(dryCleaningCost)}`;
                planHTML += `</div>`;
            }
            
            // Рекомендации по распределению обязанностей
            if (staffRequired === 0) {
                planHTML += `
                    <div class="work-plan-item">
                        <div class="work-plan-badge">!</div>
                        <div><i class="fas fa-info-circle"></i> Сотрудники не требуются (только дополнительные услуги или химчистка)</div>
                    </div>
                `;
            } else if (staffRequired === 1) {
                planHTML += `
                    <div class="work-plan-item">
                        <div class="work-plan-badge">1</div>
                        <div><i class="fas fa-user"></i> 1 сотрудник выполняет полный цикл уборки за ${formatTime(timePerWorker)}</div>
                    </div>
                `;
            } else if (staffRequired === 2) {
                planHTML += `
                    <div class="work-plan-item">
                        <div class="work-plan-badge">1</div>
                        <div><i class="fas fa-tint"></i> Влажная уборка, мойка сантехники и кухни</div>
                    </div>
                    <div class="work-plan-item">
                        <div class="work-plan-badge">2</div>
                        <div><i class="fas fa-wind"></i> Сухая уборка, обеспыливание, дополнительные услуги</div>
                    </div>
                `;
            } else if (staffRequired >= 3) {
                planHTML += `
                    <div class="work-plan-item">
                        <div class="work-plan-badge">1</div>
                        <div><i class="fas fa-tint"></i> Влажная уборка полов и поверхностей</div>
                    </div>
                    <div class="work-plan-item">
                        <div class="work-plan-badge">2</div>
                        <div><i class="fas fa-shower"></i> Сантехника, кухня, окна</div>
                    </div>
                    <div class="work-plan-item">
                        <div class="work-plan-badge">3</div>
                        <div><i class="fas fa-wind"></i> Сухая уборка, пылесос, вынос мусора</div>
                    </div>
                `;
            }
            
            // Экономическая информация
            planHTML += `<div style="margin-top: 15px; padding-top: 10px; border-top: 2px dashed #ddd;">`;
            
            if (area > 0) {
                planHTML += `<strong><i class="fas fa-vector-square"></i> Площадь уборки:</strong> ${area} м²<br>`;
                planHTML += `<strong><i class="fas fa-clock"></i> Общее время:</strong> ${formatTime(totalManHours)} (${totalManHours.toFixed(1)} чел-ч)<br>`;
                planHTML += `<strong><i class="fas fa-user-clock"></i> На 1 сотрудника:</strong> ${formatTime(timePerWorker)}<br>`;
                planHTML += `<strong><i class="fas fa-money-bill-wave"></i> Стоимость уборки:</strong> ${mainCleaningCostResultElement.textContent}<br>`;
            }
            
            if (additionalCost > 0) {
                planHTML += `<strong><i class="fas fa-plus-circle"></i> Доп. услуги клининга:</strong> ${formatMoney(additionalCost)}<br>`;
            }
            
            if (dryCleaningCost > 0) {
                planHTML += `<strong><i class="fas fa-tshirt"></i> Услуги химчистки:</strong> ${formatMoney(dryCleaningCost)}<br>`;
            }
            
            if (logisticsCost.total > 0) {
                planHTML += `<strong><i class="fas fa-truck"></i> Логистика:</strong> ${formatMoney(logisticsCost.total)}<br>`;
            }
            
            if (discountPercent > 0) {
                planHTML += `<strong><i class="fas fa-tag"></i> Скидка:</strong> ${discountPercent}%<br>`;
            }
            
            planHTML += `<strong><i class="fas fa-receipt"></i> Итоговая стоимость:</strong> ${finalPriceElement.textContent}<br>`;
            planHTML += `<strong><i class="fas fa-chart-line"></i> Маржинальность:</strong> ${marginPercentElement.textContent}`;
            
            planHTML += `</div>`;
            planHTML += '</div>';
            
            workPlanElement.innerHTML = planHTML;
        }
        
        // Сброс всех параметров к исходным значениям
        function resetCalculator() {
            // Сброс основных параметров
            objectTypeSelect.value = 'apartment';
            areaInput.value = 100;
            areaSlider.value = 100;
            
            // Сброс типа уборки к поддерживающей
            document.querySelector('input[name="cleaningType"][value="maintenance"]').checked = true;
            
            pollutionLevelSelect.value = '1.0';
            
            // Сброс выбора количества сотрудников
            staffModeAuto.checked = true;
            staffModeManual.checked = false;
            manualStaffSelection.style.display = 'none';
            autoStaffInfo.style.display = 'block';
            manualStaffCount = 2;
            staffCountDisplay.textContent = '2';
            
            // Сброс экономического режима
            economyModeToggle.checked = true;
            economyStatus.textContent = 'ВКЛ';
            economyStatus.style.color = '#28a745';
            
            // Сброс скидки
            discountInput.value = 0;
            discountSlider.value = 0;
            
            // Сброс логистических услуг
            carServiceCheckbox.checked = false;
            equipmentDeliveryCheckbox.checked = false;
            
            // Сброс дополнительных услуг клининга
            additionalServices.forEach(service => {
                const input = document.getElementById(`qty-${service.id}`);
                if (input) input.value = 0;
                const totalElement = document.getElementById(`total-${service.id}`);
                if (totalElement) {
                    totalElement.textContent = '0 руб';
                    totalElement.style.color = '#182848';
                }
            });
            
            // Сброс услуг химчистки
            dryCleaningServices.forEach(category => {
                category.items.forEach(item => {
                    const input = document.getElementById(`qty-dry-${item.id}`);
                    if (input) input.value = 0;
                    const totalElement = document.getElementById(`total-dry-${item.id}`);
                    if (totalElement) {
                        totalElement.textContent = '0 руб';
                        totalElement.style.color = '#182848';
                    }
                });
            });
            
            // Обновление итогов
            additionalServicesTotal.innerHTML = `<i class="fas fa-receipt"></i> Дополнительные услуги клининга: 0 часов, 0 руб.`;
            dryCleaningTotal.innerHTML = `<i class="fas fa-receipt"></i> Услуги химчистки: 0 руб.`;
            
            // Сброс результатов
            baseTimeElement.textContent = '-';
            additionalTimeElement.textContent = '-';
            dryCleaningCostResultElement.textContent = '-';
            totalTimeElement.textContent = '-';
            staffRequiredElement.textContent = '-';
            complexityLevelElement.textContent = '-';
            complexityBadgeElement.textContent = '';
            complexityBadgeElement.className = 'complexity-badge';
            timePerWorkerElement.textContent = '-';
            mainCleaningCostResultElement.textContent = '-';
            
            recommendationMainElement.innerHTML = `<i class="fas fa-magic"></i> Заполните параметры и нажмите "Рассчитать"`;
            
            // Скрытие разделов с экономикой
            costSection.style.display = 'none';
            finalPriceSection.style.display = 'none';
            
            // Сброс плана работы
            workPlanElement.innerHTML = `<p>После расчета появится подробный план работы для вашего объекта.</p>`;
            additionalInfoElement.innerHTML = '';
            
            // Сброс рекомендации по персоналу
            currentRecommendedStaff = 2;
            recommendedStaffCount.textContent = '2';
            if (window.updateStaffRecommendation) {
                window.updateStaffRecommendation();
            }
            
            // Выполняем расчет для обновления интерфейса
            performCalculation();
        }
        
        // Основная функция расчета с индикатором загрузки
        function calculateFull() {
            loadingIndicator.style.display = 'block';
            calculateBtn.disabled = true;
            calculateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Расчет...';
            
            setTimeout(() => {
                performCalculation();
                loadingIndicator.style.display = 'none';
                calculateBtn.disabled = false;
                calculateBtn.innerHTML = '<i class="fas fa-calculator"></i> Рассчитать полную стоимость';
            }, 500);
        }
        
        // Автоматический пересчет при изменении основных параметров
        let calculationTimeout;
        
        function scheduleCalculation() {
            clearTimeout(calculationTimeout);
            calculationTimeout = setTimeout(() => {
                performCalculation();
            }, 300);
        }
        
        // Добавляем функцию для обновления отображения коэффициентов загрязнения
        function updatePollutionIndicators() {
            const pollutionOptions = pollutionLevelSelect.options;
            
            for (let i = 0; i < pollutionOptions.length; i++) {
                const option = pollutionOptions[i];
                const value = parseFloat(option.value);
                const coefficient = pollutionCoefficients[value];
                
                if (coefficient) {
                    // Обновляем текст опции
                    const baseText = option.text.split(' ×')[0];
                    option.text = `${baseText} ×${coefficient.multiplier}`;
                    
                    // Обновляем индикатор
                    const indicatorSpan = option.querySelector('.pollution-indicator');
                    if (indicatorSpan) {
                        indicatorSpan.className = `pollution-indicator ${coefficient.color}`;
                    }
                }
            }
        }
        
        // Инициализация при загрузке страницы
        window.addEventListener('DOMContentLoaded', function() {
            // Генерация списков услуг
            generateServicesList();
            generateDryCleaningList();
            
            // Инициализация выбора количества сотрудников
            initStaffSelection();
            
            // Обновление индикаторов загрязнения
            updatePollutionIndicators();
            
            // Установим начальные значения
            areaSlider.value = areaInput.value;
            discountSlider.value = discountInput.value;
            economyStatus.textContent = 'ВКЛ';
            economyStatus.style.color = '#28a745';
            economyStatus.style.fontWeight = 'bold';
            
            // Обработчики событий
            areaInput.addEventListener('input', function() {
                areaSlider.value = this.value;
                scheduleCalculation();
            });
            
            areaSlider.addEventListener('input', function() {
                areaInput.value = this.value;
                scheduleCalculation();
            });
            
            discountInput.addEventListener('input', function() {
                discountSlider.value = this.value;
                scheduleCalculation();
            });
            
            discountSlider.addEventListener('input', function() {
                discountInput.value = this.value;
                scheduleCalculation();
            });
            
            economyModeToggle.addEventListener('change', function() {
                economyStatus.textContent = this.checked ? 'ВКЛ' : 'ВЫКЛ';
                economyStatus.style.color = this.checked ? '#28a745' : '#dc3545';
                scheduleCalculation();
            });
            
            objectTypeSelect.addEventListener('change', scheduleCalculation);
            pollutionLevelSelect.addEventListener('change', scheduleCalculation);
            carServiceCheckbox.addEventListener('change', scheduleCalculation);
            equipmentDeliveryCheckbox.addEventListener('change', scheduleCalculation);
            
            document.querySelectorAll('input[name="cleaningType"]').forEach(radio => {
                radio.addEventListener('change', scheduleCalculation);
            });
            
            // Обработчики для кнопок
            calculateBtn.addEventListener('click', calculateFull);
            resetBtn.addEventListener('click', resetCalculator);
            
            // Выполним расчет при загрузке
            calculateFull();
        });
    </script>
</body>
</html>
